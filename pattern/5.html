<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5. Privacy-Preserving State Discovery — A Pattern Language for Aztec-nr</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../theme.css">
</head>
<body class="">
    <header class="site-header">
        <div class="header-content">
            <a href="../index.html" class="site-title">A Pattern Language for Aztec-nr</a>
            <span class="site-subtitle">Privacy-Preserving Smart Contract Development in Noir</span>
            <div class="search-container">
                <input type="text" id="search-input" placeholder="Search patterns..." autocomplete="off">
                <div id="search-results" class="search-results" hidden></div>
            </div>
        </div>
        <nav class="scale-nav">
            
            <a href="../scale/system.html">System Architecture</a>
            
            <a href="../scale/framework.html">Framework Abstractions</a>
            
            <a href="../scale/implementation.html">Implementation</a>
            
            <span class="nav-separator">|</span>
            <a href="../graph.html">Graph</a>
        </nav>
    </header>

    <main>
        
<article class="pattern-page">
    <nav class="pattern-nav">
        
        <a href="4.html" class="nav-prev">&larr; 4. Asynchronous Cross-Domain Messaging</a>
        

        <a href="../index.html" class="nav-up">All Patterns</a>

        
        <a href="11.html" class="nav-next">11. Context-Aware Type System &rarr;</a>
        
    </nav>

    <header class="pattern-header">
        
        <a href="../scale/system.html" class="pattern-scale-link">System Architecture</a>
        
        <h1>
            <span class="pattern-number">5</span>
            Privacy-Preserving State Discovery
            <span class="confidence-indicator" title="Invariant">★★</span>
        </h1>
        
        <div class="pattern-tags">
            
            <span class="tag">privacy</span>
            
            <span class="tag">discovery</span>
            
            <span class="tag">oracle</span>
            
            <span class="tag">pxe</span>
            
        </div>
        
    </header>

    

    <div class="pattern-body">
        <p>In a privacy-preserving system, the blockchain stores only hashes of private state. But the user's client must somehow learn which notes it owns without asking the network to reveal them.</p>
<h2 id="context">Context</h2>
<p>Aztec solves state discovery through the <strong>PXE</strong> (Private eXecution Environment), a client-side component that maintains a local database of the user's notes. When a note is created, it must be delivered to its intended owner through encrypted messages (see <strong>Explicit Delivery</strong>). The PXE decrypts incoming messages, verifies the note hashes against the on-chain tree, and stores the notes locally.</p>
<p>Within contract code, reading private state involves calling <strong>oracles</strong> -- special unconstrained functions that query the PXE's local database. The oracle returns candidate notes, and the constrained circuit verifies their existence via tree membership proofs. This separation ensures the PXE can use efficient database queries while the circuit maintains cryptographic guarantees.</p>
<p>The <code>sync_state()</code> and <code>process_message()</code> functions are auto-generated by the <code>#[aztec]</code> macro and handle the mechanics of note discovery and message decryption at the contract level.</p>
<h2 id="therefore">Therefore</h2>
<p>Trust the oracle-based discovery model. Use <code>get_note()</code> and <code>get_notes()</code> to retrieve private state, knowing that the framework handles the proof-of-existence verification. Ensure that newly created notes are delivered to their owners using the <strong>Explicit Delivery</strong> pattern so that the recipients' PXE instances can discover them.</p>
<h2 id="consequences">Consequences</h2>
<p>Private state is only as available as its delivery mechanism. If a note is created but never delivered (or delivered with the wrong encryption), the recipient will not be able to discover it. The framework enforces intentionality about delivery through the <code>NoteMessage</code> return type from <code>create_note</code>, making it difficult to accidentally forget delivery.</p>
    </div>

    
    <div class="cross-ref cross-ref-down">
        <span class="cross-ref-label">Contains:</span>
        
        <a href="16.html" class="cross-ref-link">16. Note Lifecycle</a>, 
        
        <a href="17.html" class="cross-ref-link">17. Explicit Delivery</a>
        
    </div>
    

    <nav class="pattern-nav pattern-nav-bottom">
        
        <a href="4.html" class="nav-prev">&larr; 4. Asynchronous Cross-Domain Messaging</a>
        

        <a href="../index.html" class="nav-up">All Patterns</a>

        
        <a href="11.html" class="nav-next">11. Context-Aware Type System &rarr;</a>
        
    </nav>
</article>

    </main>

    <footer class="site-footer">
        <p>The Aztec Team</p>
        <p class="generator-credit">Built with <a href="https://github.com/language-patterner">language-patterner</a></p>
    </footer>

    <script>
        window.SEARCH_INDEX_URL = "../search-index.json";
        window.ROOT_PREFIX = "../";
    </script>
    <script src="../search.js"></script>
</body>
</html>