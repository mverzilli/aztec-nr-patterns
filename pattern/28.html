<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>28. Initialization Guards — A Pattern Language for Aztec-nr</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../theme.css">
</head>
<body class="">
    <header class="site-header">
        <div class="header-content">
            <a href="../index.html" class="site-title">A Pattern Language for Aztec-nr</a>
            <span class="site-subtitle">Privacy-Preserving Smart Contract Development in Noir</span>
            <div class="search-container">
                <input type="text" id="search-input" placeholder="Search patterns..." autocomplete="off">
                <div id="search-results" class="search-results" hidden></div>
            </div>
        </div>
        <nav class="scale-nav">
            
            <a href="../scale/system.html">System Architecture</a>
            
            <a href="../scale/framework.html">Framework Abstractions</a>
            
            <a href="../scale/implementation.html">Implementation</a>
            
            <span class="nav-separator">|</span>
            <a href="../graph.html">Graph</a>
        </nav>
    </header>

    <main>
        
<article class="pattern-page">
    <nav class="pattern-nav">
        
        <a href="27.html" class="nav-prev">&larr; 27. Generated Calling Interfaces</a>
        

        <a href="../index.html" class="nav-up">All Patterns</a>

        
        <a href="29.html" class="nav-next">29. Function Annotation Convention &rarr;</a>
        
    </nav>

    <header class="pattern-header">
        
        <a href="../scale/implementation.html" class="pattern-scale-link">Implementation</a>
        
        <h1>
            <span class="pattern-number">28</span>
            Initialization Guards
            <span class="confidence-indicator" title="Invariant">★★</span>
        </h1>
        
        <div class="pattern-tags">
            
            <span class="tag">initialization</span>
            
            <span class="tag">constructor</span>
            
            <span class="tag">nullifier</span>
            
            <span class="tag">safety</span>
            
        </div>
        
    </header>

    

    <div class="pattern-body">
        <p>A contract that can be initialized multiple times is vulnerable to state reset attacks. But in a privacy-preserving system, simply checking a boolean flag in public storage would leak information about the contract's initialization status.</p>
<h2 id="context">Context</h2>
<p>Contracts use an <strong>initialization nullifier</strong> to enforce single initialization. When a function marked with <code>#[initializer]</code> executes, it emits a nullifier derived from the contract's address. Any subsequent attempt to call an initializer will try to emit the same nullifier, which the kernel rejects because the nullifier already exists in the tree.</p>
<p>A contract can have multiple functions marked <code>#[initializer]</code> (e.g., one for private setup, one for public setup), but they are all mutually exclusive -- whichever runs first claims the initialization nullifier. Functions not marked as initializers will fail if called before initialization, because the framework checks for the initialization nullifier's existence.</p>
<p>The <code>#[noinitcheck]</code> annotation opts a function out of the initialization check, useful for functions that genuinely work without initialization (e.g., utility functions).</p>
<h2 id="therefore">Therefore</h2>
<p>Mark at least one function with <code>#[initializer]</code> in every contract. Use <code>#[noinitcheck]</code> sparingly and only for functions that are provably safe to call before initialization. If a contract needs both private and public setup, have the private initializer enqueue the public setup function using the enqueue pattern.</p>
<h2 id="consequences">Consequences</h2>
<p>The nullifier-based approach provides privacy-preserving initialization enforcement -- the nullifier's existence proves initialization happened, but its value does not reveal which initializer was called or with what arguments. The trade-off is that initialization is irreversible: there is no "re-initialize" operation, matching the immutability expectations of deployed contracts.</p>
    </div>

    

    <nav class="pattern-nav pattern-nav-bottom">
        
        <a href="27.html" class="nav-prev">&larr; 27. Generated Calling Interfaces</a>
        

        <a href="../index.html" class="nav-up">All Patterns</a>

        
        <a href="29.html" class="nav-next">29. Function Annotation Convention &rarr;</a>
        
    </nav>
</article>

    </main>

    <footer class="site-footer">
        <p></p>
        <p class="generator-credit">Built with <a href="https://github.com/language-patterner">language-patterner</a></p>
    </footer>

    <script>
        window.SEARCH_INDEX_URL = "../search-index.json";
        window.ROOT_PREFIX = "../";
    </script>
    <script src="../search.js"></script>
</body>
</html>