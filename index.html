<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Pattern Language for Aztec-nr</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="theme.css">
</head>
<body class="">
    <header class="site-header">
        <div class="header-content">
            <a href="index.html" class="site-title">A Pattern Language for Aztec-nr</a>
            <span class="site-subtitle">Privacy-Preserving Smart Contract Development in Noir</span>
            <div class="search-container">
                <input type="text" id="search-input" placeholder="Search patterns..." autocomplete="off">
                <div id="search-results" class="search-results" hidden></div>
            </div>
        </div>
        <nav class="scale-nav">
            
            <a href="scale/system.html">System Architecture</a>
            
            <a href="scale/framework.html">Framework Abstractions</a>
            
            <a href="scale/implementation.html">Implementation</a>
            
            <span class="nav-separator">|</span>
            <a href="graph.html">Graph</a>
        </nav>
    </header>

    <main>
        
<div class="index-page">
    <div class="book-header">
        <h1>A Pattern Language for Aztec-nr</h1>
        <p class="subtitle">Privacy-Preserving Smart Contract Development in Noir</p>
        
        <p class="authors">The Aztec Team</p>
        
        <p class="pattern-count">20 patterns</p>
    </div>

    
    <section class="containment-tree">
        <h2>Pattern Structure</h2>
        
        
        <ul class="tree-list">
            
            <li class="tree-node" data-scale-index="0">
                <a class="tree-node-link" href="pattern/1.html">
                    <span class="tree-node-number">1</span>
                    <span class="tree-node-name">Dual Execution Model</span>
                </a>
                
                
        <ul class="tree-list">
            
            <li class="tree-node" data-scale-index="1">
                <a class="tree-node-link" href="pattern/11.html">
                    <span class="tree-node-number">11</span>
                    <span class="tree-node-name">Context-Aware Type System</span>
                </a>
                
                
        <ul class="tree-list">
            
            <li class="tree-node" data-scale-index="1">
                <a class="tree-node-link" href="pattern/13.html">
                    <span class="tree-node-number">13</span>
                    <span class="tree-node-name">State Variable Hierarchy</span>
                </a>
                
                
        <ul class="tree-list">
            
            <li class="tree-node" data-scale-index="1">
                <a class="tree-node-link" href="pattern/14.html">
                    <span class="tree-node-number">14</span>
                    <span class="tree-node-name">Owned State Containers</span>
                </a>
                
            </li>
            
            <li class="tree-node" data-scale-index="1">
                <a class="tree-node-link" href="pattern/15.html">
                    <span class="tree-node-number">15</span>
                    <span class="tree-node-name">Storage Slot Derivation</span>
                </a>
                
            </li>
            
        </ul>
        
                
            </li>
            
            <li class="tree-node" data-scale-index="2">
                <a class="tree-node-link" href="pattern/30.html">
                    <span class="tree-node-number">30</span>
                    <span class="tree-node-name">Packable Serialization</span>
                </a>
                
            </li>
            
        </ul>
        
                
            </li>
            
            <li class="tree-node" data-scale-index="1">
                <a class="tree-node-link" href="pattern/12.html">
                    <span class="tree-node-number">12</span>
                    <span class="tree-node-name">The Self Object</span>
                </a>
                
                
        <ul class="tree-list">
            
            <li class="tree-node" data-scale-index="2">
                <a class="tree-node-link" href="pattern/27.html">
                    <span class="tree-node-number">27</span>
                    <span class="tree-node-name">Generated Calling Interfaces</span>
                </a>
                
            </li>
            
        </ul>
        
                
            </li>
            
            <li class="tree-node" data-scale-index="1">
                <a class="tree-node-link" href="pattern/18.html">
                    <span class="tree-node-number">18</span>
                    <span class="tree-node-name">Event Emission Protocol</span>
                </a>
                
            </li>
            
        </ul>
        
                
            </li>
            
            <li class="tree-node" data-scale-index="0">
                <a class="tree-node-link" href="pattern/2.html">
                    <span class="tree-node-number">2</span>
                    <span class="tree-node-name">UTXO-Based Private State</span>
                </a>
                
                
        <ul class="tree-list">
            
            <li class="tree-node" data-scale-index="1">
                <a class="tree-node-link" href="pattern/14.html">
                    <span class="tree-node-number">14</span>
                    <span class="tree-node-name">Owned State Containers</span>
                </a>
                
            </li>
            
            <li class="tree-node" data-scale-index="1">
                <a class="tree-node-link" href="pattern/16.html">
                    <span class="tree-node-number">16</span>
                    <span class="tree-node-name">Note Lifecycle</span>
                </a>
                
            </li>
            
            <li class="tree-node" data-scale-index="1">
                <a class="tree-node-link" href="pattern/17.html">
                    <span class="tree-node-number">17</span>
                    <span class="tree-node-name">Explicit Delivery</span>
                </a>
                
            </li>
            
        </ul>
        
                
            </li>
            
            <li class="tree-node" data-scale-index="0">
                <a class="tree-node-link" href="pattern/4.html">
                    <span class="tree-node-number">4</span>
                    <span class="tree-node-name">Asynchronous Cross-Domain Messaging</span>
                </a>
                
                
        <ul class="tree-list">
            
            <li class="tree-node" data-scale-index="2">
                <a class="tree-node-link" href="pattern/27.html">
                    <span class="tree-node-number">27</span>
                    <span class="tree-node-name">Generated Calling Interfaces</span>
                </a>
                
            </li>
            
            <li class="tree-node" data-scale-index="2">
                <a class="tree-node-link" href="pattern/31.html">
                    <span class="tree-node-number">31</span>
                    <span class="tree-node-name">Partial Notes</span>
                </a>
                
            </li>
            
        </ul>
        
                
            </li>
            
            <li class="tree-node" data-scale-index="0">
                <a class="tree-node-link" href="pattern/5.html">
                    <span class="tree-node-number">5</span>
                    <span class="tree-node-name">Privacy-Preserving State Discovery</span>
                </a>
                
                
        <ul class="tree-list">
            
            <li class="tree-node" data-scale-index="1">
                <a class="tree-node-link" href="pattern/16.html">
                    <span class="tree-node-number">16</span>
                    <span class="tree-node-name">Note Lifecycle</span>
                </a>
                
            </li>
            
            <li class="tree-node" data-scale-index="1">
                <a class="tree-node-link" href="pattern/17.html">
                    <span class="tree-node-number">17</span>
                    <span class="tree-node-name">Explicit Delivery</span>
                </a>
                
            </li>
            
        </ul>
        
                
            </li>
            
            <li class="tree-node" data-scale-index="2">
                <a class="tree-node-link" href="pattern/26.html">
                    <span class="tree-node-number">26</span>
                    <span class="tree-node-name">Macro-Driven Contract Definition</span>
                </a>
                
                
        <ul class="tree-list">
            
            <li class="tree-node" data-scale-index="2">
                <a class="tree-node-link" href="pattern/27.html">
                    <span class="tree-node-number">27</span>
                    <span class="tree-node-name">Generated Calling Interfaces</span>
                </a>
                
            </li>
            
            <li class="tree-node" data-scale-index="2">
                <a class="tree-node-link" href="pattern/30.html">
                    <span class="tree-node-number">30</span>
                    <span class="tree-node-name">Packable Serialization</span>
                </a>
                
            </li>
            
        </ul>
        
                
            </li>
            
        </ul>
        

        
        <div class="orphan-patterns">
            <h3>Independent Patterns</h3>
            <ul class="tree-list">
                
                <li class="tree-node" data-scale-index="0">
                    <a class="tree-node-link" href="pattern/3.html">
                        <span class="tree-node-number">3</span>
                        <span class="tree-node-name">Kernel Siloing</span>
                    </a>
                </li>
                
                <li class="tree-node" data-scale-index="1">
                    <a class="tree-node-link" href="pattern/19.html">
                        <span class="tree-node-number">19</span>
                        <span class="tree-node-name">Authorization Witnesses</span>
                    </a>
                </li>
                
                <li class="tree-node" data-scale-index="2">
                    <a class="tree-node-link" href="pattern/28.html">
                        <span class="tree-node-number">28</span>
                        <span class="tree-node-name">Initialization Guards</span>
                    </a>
                </li>
                
                <li class="tree-node" data-scale-index="2">
                    <a class="tree-node-link" href="pattern/30.html">
                        <span class="tree-node-number">30</span>
                        <span class="tree-node-name">Packable Serialization</span>
                    </a>
                </li>
                
            </ul>
        </div>
        
    </section>
    

    
    
    
    <section class="scale-group" id="scale-system">
        <h2>
            <a href="scale/system.html">System Architecture</a>
            <span class="scale-range">1&ndash;10</span>
        </h2>
        <p class="scale-description">Patterns shaping the dual-execution, privacy-preserving blockchain model</p>

        <ol class="pattern-list">
            
            <li class="pattern-entry confidence-2">
                <a href="pattern/1.html">
                    <span class="pattern-number">1</span>
                    <span class="pattern-name">Dual Execution Model</span>
                    <span class="confidence-indicator" title="Invariant">★★</span>
                </a>
                
                <p class="pattern-problem">A blockchain that executes everything publicly leaks all user data, but a blockchain that executes everything privately cannot support shared mutable state. The system needs both modes, but combining them introduces fundamental asymmetries in timing, visibility, and guarantees.</p>
                
            </li>
            
            <li class="pattern-entry confidence-2">
                <a href="pattern/2.html">
                    <span class="pattern-number">2</span>
                    <span class="pattern-name">UTXO-Based Private State</span>
                    <span class="confidence-indicator" title="Invariant">★★</span>
                </a>
                
                <p class="pattern-problem">An account model for private state (like Solidity&#39;s storage slots) would require a global view of all state to verify transitions, destroying privacy. The system needs a way to represent private state that can be created, read, and destroyed without revealing its contents or existence to other users.</p>
                
            </li>
            
            <li class="pattern-entry confidence-2">
                <a href="pattern/3.html">
                    <span class="pattern-number">3</span>
                    <span class="pattern-name">Kernel Siloing</span>
                    <span class="confidence-indicator" title="Invariant">★★</span>
                </a>
                
                <p class="pattern-problem">If two contracts independently create notes with the same hash, or if a malicious contract can produce nullifiers that collide with another contract&#39;s notes, the integrity of private state collapses.</p>
                
            </li>
            
            <li class="pattern-entry confidence-2">
                <a href="pattern/4.html">
                    <span class="pattern-number">4</span>
                    <span class="pattern-name">Asynchronous Cross-Domain Messaging</span>
                    <span class="confidence-indicator" title="Invariant">★★</span>
                </a>
                
                <p class="pattern-problem">Private functions execute on the user&#39;s device against historical state, while public functions execute on the block proposer against current state. A private function cannot synchronously call a public function because it would need access to state that does not yet exist from its perspective.</p>
                
            </li>
            
            <li class="pattern-entry confidence-2">
                <a href="pattern/5.html">
                    <span class="pattern-number">5</span>
                    <span class="pattern-name">Privacy-Preserving State Discovery</span>
                    <span class="confidence-indicator" title="Invariant">★★</span>
                </a>
                
                <p class="pattern-problem">In a privacy-preserving system, the blockchain stores only hashes of private state. But the user&#39;s client must somehow learn which notes it owns without asking the network to reveal them.</p>
                
            </li>
            
        </ol>
    </section>
    
    
    
    
    <section class="scale-group" id="scale-framework">
        <h2>
            <a href="scale/framework.html">Framework Abstractions</a>
            <span class="scale-range">11&ndash;25</span>
        </h2>
        <p class="scale-description">Patterns for the core abstractions that contract developers use daily</p>

        <ol class="pattern-list">
            
            <li class="pattern-entry confidence-2">
                <a href="pattern/11.html">
                    <span class="pattern-number">11</span>
                    <span class="pattern-name">Context-Aware Type System</span>
                    <span class="confidence-indicator" title="Invariant">★★</span>
                </a>
                
                <p class="pattern-problem">A developer might accidentally read public mutable state from a private function, or attempt to create notes in a public context. These errors are subtle and would produce cryptographically invalid proofs at runtime -- far too late to catch.</p>
                
            </li>
            
            <li class="pattern-entry confidence-2">
                <a href="pattern/12.html">
                    <span class="pattern-number">12</span>
                    <span class="pattern-name">The Self Object</span>
                    <span class="confidence-indicator" title="Invariant">★★</span>
                </a>
                
                <p class="pattern-problem">Contract functions need access to storage, the execution context, the contract&#39;s own address, and the ability to call other contracts or emit events. Passing all of these as separate parameters would be verbose and error-prone.</p>
                
            </li>
            
            <li class="pattern-entry confidence-2">
                <a href="pattern/13.html">
                    <span class="pattern-number">13</span>
                    <span class="pattern-name">State Variable Hierarchy</span>
                    <span class="confidence-indicator" title="Invariant">★★</span>
                </a>
                
                <p class="pattern-problem">The dual-execution model demands different storage semantics for public and private state, yet contracts need a uniform way to declare and organize their storage. Without a shared abstraction, each state variable type would require its own initialization and slot-assignment logic.</p>
                
            </li>
            
            <li class="pattern-entry confidence-2">
                <a href="pattern/14.html">
                    <span class="pattern-number">14</span>
                    <span class="pattern-name">Owned State Containers</span>
                    <span class="confidence-indicator" title="Invariant">★★</span>
                </a>
                
                <p class="pattern-problem">Private state variables hold notes that belong to specific owners, but the storage system assigns a single base slot per field. Without a way to scope private state by owner, every user&#39;s notes would share the same storage slot, making retrieval inefficient and semantics unclear.</p>
                
            </li>
            
            <li class="pattern-entry confidence-2">
                <a href="pattern/15.html">
                    <span class="pattern-number">15</span>
                    <span class="pattern-name">Storage Slot Derivation</span>
                    <span class="confidence-indicator" title="Invariant">★★</span>
                </a>
                
                <p class="pattern-problem">A mapping from keys to values needs a way to assign unique storage slots to each key-value pair. Using sequential numbering would require knowing all keys in advance, which is impossible for open-ended mappings like user balances.</p>
                
            </li>
            
            <li class="pattern-entry confidence-2">
                <a href="pattern/16.html">
                    <span class="pattern-number">16</span>
                    <span class="pattern-name">Note Lifecycle</span>
                    <span class="confidence-indicator" title="Invariant">★★</span>
                </a>
                
                <p class="pattern-problem">Notes are the atoms of private state, but they have a non-trivial lifecycle: creation, retrieval, and destruction each involve different cryptographic operations and different interactions with the kernel and PXE.</p>
                
            </li>
            
            <li class="pattern-entry confidence-2">
                <a href="pattern/17.html">
                    <span class="pattern-number">17</span>
                    <span class="pattern-name">Explicit Delivery</span>
                    <span class="confidence-indicator" title="Invariant">★★</span>
                </a>
                
                <p class="pattern-problem">A created note is useless to its owner until the owner&#39;s PXE discovers it. If the framework silently handled delivery, developers might not realize that a missing or misconfigured delivery means the recipient can never access their state.</p>
                
            </li>
            
            <li class="pattern-entry confidence-2">
                <a href="pattern/18.html">
                    <span class="pattern-number">18</span>
                    <span class="pattern-name">Event Emission Protocol</span>
                    <span class="confidence-indicator" title="Invariant">★★</span>
                </a>
                
                <p class="pattern-problem">Contracts need to emit observable side-effects for off-chain indexing, but in a privacy-preserving system, events must support both encrypted (private) and transparent (public) emission modes.</p>
                
            </li>
            
            <li class="pattern-entry confidence-2">
                <a href="pattern/19.html">
                    <span class="pattern-number">19</span>
                    <span class="pattern-name">Authorization Witnesses</span>
                    <span class="confidence-indicator" title="Invariant">★★</span>
                </a>
                
                <p class="pattern-problem">In a privacy-preserving system, the traditional `msg.sender` check for authorization is insufficient. A user might want to authorize a specific action without being the direct caller, or delegate authority to a contract acting on their behalf.</p>
                
            </li>
            
        </ol>
    </section>
    
    
    
    
    <section class="scale-group" id="scale-implementation">
        <h2>
            <a href="scale/implementation.html">Implementation</a>
            <span class="scale-range">26&ndash;40</span>
        </h2>
        <p class="scale-description">Patterns at the code level: macros, conventions, and techniques</p>

        <ol class="pattern-list">
            
            <li class="pattern-entry confidence-2">
                <a href="pattern/26.html">
                    <span class="pattern-number">26</span>
                    <span class="pattern-name">Macro-Driven Contract Definition</span>
                    <span class="confidence-indicator" title="Invariant">★★</span>
                </a>
                
                <p class="pattern-problem">A privacy-preserving smart contract requires substantial boilerplate: note hash and nullifier computation dispatch, state synchronization entry points, message decryption logic, and ABI exports. Writing this by hand for every contract would be error-prone and tedious.</p>
                
            </li>
            
            <li class="pattern-entry confidence-2">
                <a href="pattern/27.html">
                    <span class="pattern-number">27</span>
                    <span class="pattern-name">Generated Calling Interfaces</span>
                    <span class="confidence-indicator" title="Invariant">★★</span>
                </a>
                
                <p class="pattern-problem">Cross-contract calls require encoding function selectors and arguments correctly. Manual encoding is fragile -- a mistyped selector or wrong argument order produces silent failures or invalid proofs.</p>
                
            </li>
            
            <li class="pattern-entry confidence-2">
                <a href="pattern/28.html">
                    <span class="pattern-number">28</span>
                    <span class="pattern-name">Initialization Guards</span>
                    <span class="confidence-indicator" title="Invariant">★★</span>
                </a>
                
                <p class="pattern-problem">A contract that can be initialized multiple times is vulnerable to state reset attacks. But in a privacy-preserving system, simply checking a boolean flag in public storage would leak information about the contract&#39;s initialization status.</p>
                
            </li>
            
            <li class="pattern-entry confidence-2">
                <a href="pattern/29.html">
                    <span class="pattern-number">29</span>
                    <span class="pattern-name">Function Annotation Convention</span>
                    <span class="confidence-indicator" title="Invariant">★★</span>
                </a>
                
                <p class="pattern-problem">A contract contains functions with fundamentally different execution semantics: private, public, utility, internal, initializer, view-only. Without a clear classification system, it is ambiguous which functions can be called externally and in which execution context.</p>
                
            </li>
            
            <li class="pattern-entry confidence-2">
                <a href="pattern/30.html">
                    <span class="pattern-number">30</span>
                    <span class="pattern-name">Packable Serialization</span>
                    <span class="confidence-indicator" title="Invariant">★★</span>
                </a>
                
                <p class="pattern-problem">Blockchain state is ultimately stored as arrays of finite field elements, but contract developers work with structured types (structs, integers, addresses). The system needs a uniform way to convert between structured types and field arrays for storage and hashing.</p>
                
            </li>
            
            <li class="pattern-entry confidence-1">
                <a href="pattern/31.html">
                    <span class="pattern-number">31</span>
                    <span class="pattern-name">Partial Notes</span>
                    <span class="confidence-indicator" title="Progressing">★</span>
                </a>
                
                <p class="pattern-problem">Some operations require a value that is only known after public execution, but the note must be created in private context. Neither domain alone has all the information needed to create the complete note.</p>
                
            </li>
            
        </ol>
    </section>
    
    
</div>

    </main>

    <footer class="site-footer">
        <p>The Aztec Team</p>
        <p class="generator-credit">Built with <a href="https://github.com/language-patterner">language-patterner</a></p>
    </footer>

    <script>
        window.SEARCH_INDEX_URL = "search-index.json";
        window.ROOT_PREFIX = "";
    </script>
    <script src="search.js"></script>
</body>
</html>