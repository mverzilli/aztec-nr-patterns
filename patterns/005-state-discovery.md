---
number: 5
name: Privacy-Preserving State Discovery
confidence: 2
contains: [16, 17]
contained_by: []
tags: [privacy, discovery, oracle, pxe]
---

In a privacy-preserving system, the blockchain stores only hashes of private state. But the user's client must somehow learn which notes it owns without asking the network to reveal them.

## Context

Aztec solves state discovery through the **PXE** (Private eXecution Environment), a client-side component that maintains a local database of the user's notes. When a note is created, it must be delivered to its intended owner through encrypted messages (see **Explicit Delivery**). The PXE decrypts incoming messages, verifies the note hashes against the on-chain tree, and stores the notes locally.

Within contract code, reading private state involves calling **oracles** -- special unconstrained functions that query the PXE's local database. The oracle returns candidate notes, and the constrained circuit verifies their existence via tree membership proofs. This separation ensures the PXE can use efficient database queries while the circuit maintains cryptographic guarantees.

The `sync_state()` and `process_message()` functions are auto-generated by the `#[aztec]` macro and handle the mechanics of note discovery and message decryption at the contract level.

## Therefore

Trust the oracle-based discovery model. Use `get_note()` and `get_notes()` to retrieve private state, knowing that the framework handles the proof-of-existence verification. Ensure that newly created notes are delivered to their owners using the **Explicit Delivery** pattern so that the recipients' PXE instances can discover them.

## Consequences

Private state is only as available as its delivery mechanism. If a note is created but never delivered (or delivered with the wrong encryption), the recipient will not be able to discover it. The framework enforces intentionality about delivery through the `NoteMessage` return type from `create_note`, making it difficult to accidentally forget delivery.
